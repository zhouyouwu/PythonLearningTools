<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="club.zhouyouwu.graduate.correct.mapper.CorrectMapper">
    <resultMap id="NormalQuestion" type="club.zhouyouwu.graduate.correct.model.entity.NormalQuestion">
        <id property="quesId" column="ques_id"/>
        <result property="quesTopic" column="ques_topic"/>
        <result property="quesOptions" column="ques_options"/>
        <result property="quesAnswer" column="ques_answer"/>
        <result property="quesType" column="ques_type"/>
    </resultMap>
    <resultMap id="QuestionSolve" type="club.zhouyouwu.graduate.correct.model.param.QuestionSolve">
        <id property="id" column="id"/>
        <result property="quesId" column="ques_id"/>
        <result property="userId" column="user_id"/>
        <result property="status" column="status"/>
        <result property="programOrNormal" column="program_or_normal"/>
        <result property="replyTime" column="reply_time"/>
        <result property="answer" column="answer"/>
    </resultMap>

    <insert id="setCorrectOption">
        insert into user_question_solve
        (ques_id, user_id, status, program_or_normal)
        values
        (#{solve.quesId}, #{solve.userId}, #{solve.status}, #{solve.programOrNormal})
    </insert>
    <insert id="setCorrectOptionDetail">
        insert into user_solve_detail_info
        (answer, reply_time, status, solve_id)
        values
        (#{solve.answer}, #{solve.replyTime}, #{solve.status}, #{solve.id})
    </insert>
    <update id="updateCorrectOption">
        update user_question_solve
        set status = #{solve.status}
        where id = #{solve.id}
        limit 1
    </update>


    <select id="getQuestions" resultMap="NormalQuestion">
        select ques_id, ques_topic, ques_options, ques_answer, ques_type
        from normal_question
        where ques_id in (
        <foreach collection="quesIds" item="quesId" separator=",">
            #{quesId}
        </foreach>
        )
        order by ques_id
    </select>
    <select id="getQuestionSolve" resultMap="QuestionSolve">
        select id, ques_id, user_id, status, program_or_normal
        from user_question_solve
        where ques_id = #{quesId}
        and user_id = #{userId}
        and program_or_normal = #{model}
        order by id desc
    </select>
    <select id="getQuestionSolveId" resultType="java.lang.Long">
        select id
        from user_question_solve
        where ques_id = #{quesId}
        and user_id = #{userId}
        and program_or_normal = #{model}
        order by id desc
    </select>
</mapper>